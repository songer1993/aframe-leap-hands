<html>

<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1">
	<title>Examples â€¢ Grabbing</title>
	<!-- <script src="./dist/aframe-leap-hands.min.js"></script> -->
	<script src="./dist/aframe-leap-hands.js"></script>

	<script>
		AFRAME.registerPrimitive('a-grid', {
			defaultComponents: {
				geometry: {
					primitive: 'plane',
					width: 75,
					height: 75
				},
				rotation: {
					x: -90,
					y: 0,
					z: 0
				},
				material: {
					src: 'url(https://cdn.rawgit.com/donmccurdy/aframe-extras/v1.16.3/assets/grid.png)',
					repeat: '75 75'
				}
			},
			mappings: {
				width: 'geometry.width',
				height: 'geometry.height',
				src: 'material.src'
			}
		});
		AFRAME.registerComponent('holdable', {
			schema: {
				activeColor: {
					default: 'orange'
				}
			},
			dependencies: ['dynamic-body'],
			init: function () {
				this.physics = /** @type {AFRAME.System}     */ this.el.sceneEl.systems.physics;
				this.constraint = /** @type {CANNON.Constraint} */ null;
				this.handID = /** @type {number} */ null;
				this.el.addEventListener('handhold', this.onHoldStart.bind(this));
				this.el.addEventListener('handrelease', this.onHoldStop.bind(this));
			},
			onHoldStart: function (e) {
				if (this.handID) return;
				this.originalColor = this.el.getAttribute('material').color;
				this.el.setAttribute('material', 'color', this.data.activeColor);
				this.constraint = new CANNON.LockConstraint(this.el.body, e.detail.body);
				this.physics.driver.world.addConstraint(this.constraint);
				this.handID = e.detail.handID;
			},
			onHoldStop: function (e) {
				if (e.detail.handID !== this.handID) return;
				this.el.setAttribute('material', 'color', this.originalColor);
				this.physics.driver.world.removeConstraint(this.constraint);
				this.constraint = null;
				this.handID = null;
			}
		});
	</script>
</head>

<body>
	<a-scene>
		<!-- Player -->
		<a-entity camera="near: 0.01" fov=110 position="0 0.3 0" look-controls wasd-controls>
			<a-entity leap-hand="hand: left; enablePhysics: true; objects: [geometry]; gestureDebounce: 25; holdDistance: 10; debug: false"></a-entity>
			<a-entity leap-hand="hand: right; enablePhysics: true; objects: [geometry]; gestureDebounce: 25; holdDistance: 10; debug: false"></a-entity>
		</a-entity>

		<a-box id="box1" width="0.25" height="0.25" depth="0.25" position="-0.125 0.13 -0.5" color="red" holdable dynamic-body="shape: box"></a-box>
		<a-box id="box2" width="0.25" height="0.25" depth="0.25" position="0.00 0.4 -0.5" color="green" holdable dynamic-body="shape: box"></a-box>
		<a-box id="box3" width="0.25" height="0.25" depth="0.25" position="0.125 0.13 -0.5" color="blue" holdable dynamic-body="shape: box"></a-box>

		<!-- Terrain -->
		<a-grid static-body></a-grid>

		<!-- Lighting -->
		<a-light type="ambient" color="#ccc"></a-light>
		<a-light color="#ddf" distance="100" intensity="0.4" type="point"></a-light>
		<a-light color="#ddf" position="3 10 -10" distance="50" intensity="0.4" type="point"></a-light>
	</a-scene>
	<script>
		var box1 = document.querySelector('#box1');
		var box2 = document.querySelector('#box2');
	</script>
</body>

</html>